---
title: CF868G El Toll Caves
tags: 数学 概率期望
---

我们发现，派机器人一定是尽量让每个洞穴被派的次数相同最优，那么，我们不妨以这样的策略去派机器人，设洞穴编号从 $0\sim n-1$，我们第 $i$ 天派机器人的洞穴为 $ik\bmod n\sim (i+1)k-1\bmod n$，这样就是最优策略，容易发现，每相邻 $\gcd(n,k)$ 个洞穴是完全等价的，所以我们可以令 $n,k$ 都除以 $\gcd(n,k)$。

设 $f_i$ 为宝藏在洞穴 $i$ 内，找到宝藏的期望天数，答案即为 $\frac{1}n\sum\limits^{n-1}_{i=0} f_i$。

对于 $k\le i< n$，我们有 $f_i=f_{i-k}+1$，因为在访问这些洞穴之前，我们一定会在前一天访问洞穴 $i-k$；对于 $0\le i<k$ ，我们有 $f_i=\frac 12+\frac{1}{2}(f_{i-k+n}+1)=\frac 12f_{i-k+n}+1$，即有 $\frac 12$ 的概率一次找到，有 $\frac 12$ 的概率第一次没找到，那么在再次访问洞穴 $i$ 的前一天，我们一定会访问 $i-k+n$。

由于 $\gcd(n,k)=1$，我们可以将 $f_{1\sim n-1}$ 表示为 $af_0+b$ 的形式，再根据 $f_{0}=\frac 12f_{n-k}+1$，就可以得到一个关于 $f_0$ 的一元一次方程，就可以解出 $f_0$，进而得到所有 $f_i$ 的值，时间复杂度 $O(n)$。

我们现在只要快速求出用 $f_0$ 表示 $f_0$ 的式子就好了。

介绍一个东西：万能欧几里得算法，在平面直角坐标系内有一条不包含左端点的线段（不与 $y$ 轴平行），在其定义域内，从左到右，维护一个字符串，直线每碰到一条水平的整线就写下一个 `U`，每碰到一条竖直的整线就写下一个 `R`，碰到整点就先写 `U` 再写 `R`，给定一个字符串函数 $f$，求 $f(S)$。

要求 $f(S)$ 满足，我们定义运算 $f(S_1)\otimes f(S_2)=f(S_1+S_2)$，$\otimes$ 有结合律。假设 $\oplus$ 的时间复杂度为 $O(k)$，那么总时间复杂度为 $O(k\log n)$，

[万能欧几里得算法学习笔记](https://)