---
title: 鞅与停时定理学习笔记
tags: 数学 概率期望
---

# 鞅与停时定理

## 离散时间鞅

定义**离散时间鞅**为一个时间离散的随机过程 $\{X_0,X_1,\cdots\}$，使得 $\forall n\in \N$，均满足：

- $E(|X_n|)<\infin$；
- $E(X_{n+1}-X_n\mid X_0,X_1,\cdots,X_n)=0$；

根据这个，容易得到 $E(X_n)=X_0$。

## 停时定理

设 $t$ 为鞅过程 $\{X_0,X_1,\cdots\}$ 的停时，当下面三个条件之一成立时，有 $E(X_t)=X_0$：

- $t$ 几乎必然有界；
- $|X_{i+1}-X_i|$ 一致有界，$E(t)$ 有限；
- $X_i$ 一致有界，$t$ 几乎必然有限。

名词解释：

- $a\in\R\cup\{\infin\}$ 有限：$|a|<\infin$；
- $a\in\R\cup\{\infin\}$ 有界：$\exist l,r\in \R,a\in[l,r]$；
- $a_i\in\R\cup\{\infin\}$ 一致有界：$\forall i,\exist l,r\in \R,a_i\in[l,r]$；
- 事件 $A$ 几乎必然发生：$P(A)=1$。

## 势能函数

对于随机时间序列 $\{A_0,A_1,\cdots\}$，$t$ 为其停时，终止状态为 $A_t$，求 $E(t)$。

构造势能函数 $\Phi(A)$，满足：

- $E(\Phi(A_{n+1})-\Phi(A_n)\mid A_0,A_1,\cdots,A_n)=-1$；
- $\Phi(A_t)$ 为常数。

构造序列 $X_i=\Phi(A_i)+i$，则 $E(X_{n+1}-X_n\mid X_0,X_1,\cdots,X_n)=0$，即 $\{X_0,X_1,\cdots\}$ 是鞅。

根据停时定理，我们可以得到 $E(X_t)=E(X_0)$，即 $E(t)=E(\Phi(A_0))-\Phi(A_t)$。

## 例题

### [CF1025G Company Acquisitions](https://www.luogu.com.cn/problem/CF1025G)

设 $f(x)$ 为跟随有 $x$ 个未选中点的选中点的势能函数，整个局面的势能函数为 $\Phi(A)$，每个选中点的势能函数的和。

显然每次操作的势能变化量只和随出来的两个点有关，$u,v$ 的儿子数设为 $x,y$。

为满足 $E(\Phi(A_{n+1})-\Phi(A_n)\mid A_0,A_1,\cdots,A_n)=-1$，有


$$
f(x)+f(y)-1=\frac{1}{2}(f(x+1)+yf(0))+\frac{1}{2}(f(y+1)+xf(0))
$$


因为我们要对于任意 $x,y$ 成立，所以


$$
f(x)-\frac{1}{2}=\frac{1}{2}f(x+1)+\frac{x}{2}f(0)
$$


取 $f(0)=0$，则 $f(x)=1-2^x$。

设停时为 $t$，注意到 $\Phi(A_t)=f(n-1)=1-2^{n-1}$ 为常数，所以 $E(t)=\Phi(A_0)-\Phi(A_t)$。

### [CF1349D Slime and Biscuits](https://www.luogu.com.cn/problem/CF1349D)

设 $a_{n,i}$ 为 $n$ 步后第 $i$ 个人的饼干数量，则：

设 $f(x)$ 为有 $x$ 个饼干的人的势能函数，整个局面的势能函数为 $\Phi(A)=\sum a_{_i}$。

注意到 $E(\Phi(A_{n+1})\mid A_0,A_1,\cdots,A_n)=E(\Phi(A_{n+1})\mid A_n)$。


$$
E(\Phi(A_{n+1})\mid A_n)=\sum\limits_i\sum\limits_{j\ne i}\frac{a_{n,i}}{m(n-1)}\left(f(a_{n,i}-1)+f(a_{n,j}+1)+\sum\limits_{k\ne i,k\ne j}f(a_{n,k})\right)\\
$$


为满足 $E(\Phi(A_{n+1})-\Phi(A_n)\mid A_0,A_1,\cdots,A_n)=-1$，有


$$
\begin{aligned}
\sum\limits_{k}f(a_{n,k})-1&=\sum\limits_i\sum\limits_{j\ne i}\frac{a_{n,i}}{m(n-1)}\left(f(a_{n,i}-1)+f(a_{n,j}+1)+\sum\limits_{k\ne i,k\ne j}f(a_{n,k})\right)\\
\sum\limits_{k}f(a_{n,k})-1&=\sum_i\left(\frac{a_{n,i}}{m}f(a_{n,i}-1)+\frac{m-a_{n,i}}{m(n-1)}f(a_{n,i}+1)+\frac{(m-a_{n,i})(n-2)}{m(n-1)}f(a_{n,i})\right)\\
f(x)-\frac{x}{m}&=\frac{x}{m}f(x-1)+\frac{m-x}{m(n-1)}f(x+1)+\frac{(m-x)(n-2)}{m(n-1)}f(x)\\
f(x+1)&=\left(\frac{m(n-1)}{m-x}-(n-2)\right)f(x)-\frac{(n-1)x}{m-x}f(x-1)-\frac{(n-1)x}{m-x}
\end{aligned}
$$


将 $x=0$ 代入可得 $f(1)=f(0)$，所以取 $f(0)=f(1)=0$。

设停时为 $t$，则 $\Phi(A_t)=f(m)+(n-1)f(0)$，为常数，所以 $E(t)=\Phi(A_0)-\Phi(A_t)$。